Workflow 1 - Increment Version and Push Changes

First, we create a GitHub action file called .github/workflows/version.yml that increments the version number:

name: Version Increment

on:
  push:
    branches:
      - main

jobs:
  version:
    runs-on: ubuntu-latest
    if: "!startsWith(github.event.head_commit.message, '[RELEASE]')"
    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.GH_PERSONAL_ACCESS_TOKEN }}
      - run: git config --global user.name 'AboutBits Tech'
      - run: git config --global user.email 'tech@aboutbits.it'
      - run: npm version patch -m "[RELEASE] %s"
      - run: git push

As you can see from the code, the steps get only executed for commits on the main branch that do not start with the prefix "[RELEASE]".
By checking every commit message for the prefix, we can make sure that we only increment the version number for commits generated by a user.

In addition, you have to adjust the checkout action to clone the code using a personal GitHub access token that has repo permissions. 
If we would not provide a personal access token for the checkout action, then the GitHub actions would not be started for the commit that is pushed by this GitHub action. 
The token must be stored as a secret in the GitHub repository. In this example we used the variable name GH_PERSONAL_ACCESS_TOKEN to store and reference the token.

We also tell the npm version command to only make a patch release and so only increment the last number of the version string.
Furthermore, using the parameter -m we can define the custom prefix for the commit message generated by this command. 
This helps us to determine that this new commit is created by the pipeline and not by a user.

Note: We internally as a team are working with the feature branching approach as a pattern for managing the source code. 
This is also known as the pull request model. So we are not always directly committing and pushing to the main branch. 
That's why this approach works very well because then the CI pipelines are not incrementing the version number on every little change, 
but rater when we release bug fixes and features or in other words when we merge a pull request.
